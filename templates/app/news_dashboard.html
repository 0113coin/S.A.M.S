{% extends 'base.html' %}
{% block title %}SAMS 뉴스 대시보드{% endblock %}
{% block head_extra %}
<style>
.news-feed { max-height: 600px; overflow-y: auto; }
.news-item { border-left: 4px solid #3b82f6; padding: 1.5rem; margin-bottom: 1rem; background: white; border-radius: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s; }
.news-item:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.15); transform: translateY(-1px); }
.media-badge { display:inline-block; padding:0.25rem 0.75rem; border-radius:1rem; font-size:0.75rem; font-weight:600; text-transform:uppercase; background:#e0e7ff; color:#3730a3; }
.loading { text-align:center; padding:2rem; color:#6b7280; }
.error { text-align:center; padding:2rem; color:#dc2626; background:#fef2f2; border-radius:0.5rem; margin:1rem 0; }
</style>
{% endblock %}

{% block body %}
<div class="grid grid-cols-12 min-h-screen">
  <aside class="col-span-2 bg-white border-r">
    <div class="p-4 font-bold">SAMS</div>
    <nav class="px-2 space-y-1">
      <a href="{% url 'home' %}" class="block px-3 py-2 bg-slate-100 rounded-lg">홈</a>
      <a href="{% url 'simulation' %}" class="block px-3 py-2 hover:bg-slate-50 rounded-lg">주식 종목</a>
      <a href="{% url 'portfolio' %}" class="block px-3 py-2 hover:bg-slate-50 rounded-lg">포트폴리오</a>
      <a href="{% url 'trading' %}" class="block px-3 py-2 hover:bg-slate-50 rounded-lg">거래</a>
      <a href="{% url 'news' %}" class="block px-3 py-2 hover:bg-slate-50 rounded-lg">뉴스</a>
      <a href="{% url 'admin' %}" class="block px-3 py-2 hover:bg-slate-50 rounded-lg">설정</a>
    </nav>
  </aside>

  <main class="col-span-10 bg-slate-50 p-4 space-y-6">
    <div class="bg-white rounded-2xl shadow-soft p-6">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">AI 뉴스 피드</h1>
          <p class="text-gray-600 mt-2">시뮬레이션에서 생성된 AI 뉴스 기사들을 확인하세요</p>
        </div>
        <div class="text-right">
          <div class="text-sm text-gray-500">마지막 업데이트</div>
          <div class="text-lg font-semibold" id="lastUpdate">-</div>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-2xl shadow-soft overflow-hidden">
      <div class="p-4 border-b">
        <h3 class="text-lg font-semibold">뉴스 기사 목록</h3>
        <p class="text-sm text-slate-600 mt-1">최신 뉴스 기사들이 시간순으로 표시됩니다</p>
      </div>
      <div class="p-4">
        <div id="newsFeed" class="news-feed">
          <div class="loading">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"></div>
            뉴스 기사를 불러오는 중...
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
{% endblock %}

{% block scripts %}
<script>
async function fetchNewsFeed() {
  const el = document.getElementById('newsFeed');
  try {
    const res = await fetch('/api/simulation/news/?simulation_id=default-sim&limit=30');
    const data = await res.json();
    if (!data.success) { el.innerHTML = '<div class="error">로딩 실패</div>'; return; }
    const feed = data.data.news_feed;
    document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ko-KR');
    el.innerHTML = feed.map(n => `
      <div class="news-item">
        <div class="flex justify-between items-start mb-3">
          <div class="flex items-center gap-2">
            <span class="media-badge">${n.media_name}</span>
          </div>
          <div class="text-xs text-gray-500">${formatTime(n.created_at)}</div>
        </div>
        <div class="bg-gray-50 p-3 rounded-lg">
          <p class="text-gray-800 leading-relaxed">${n.article_text}</p>
        </div>
      </div>
    `).join('');
  } catch (e) {
    el.innerHTML = '<div class="error">로딩 실패</div>';
  }
}
function formatTime(ts){ if(!ts) return ''; return new Date(ts).toLocaleString('ko-KR', {year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}); }

document.addEventListener('DOMContentLoaded', ()=>{
  fetchNewsFeed();
  setInterval(fetchNewsFeed, 300000);
});
</script>
{% endblock %}
